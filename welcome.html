<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome Page</title>

  <!-- CSS Links -->
  <link rel="stylesheet" href="./index.css" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.5.0/mdb.min.css" rel="stylesheet" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.5.0/mdb.min.js"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f9f9f9;
    }
    header, section {
      padding: 20px;
      margin: 20px auto;
      text-align: center;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header {
      background-color: #007bff;
      color: white;
    }
    .btn-logout {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Header Section -->
  <header>
    <h1>Welcome to the Dashboard</h1>
    <p id="email-id">Loading user details...</p>
  </header>

  <!-- Section 1: Welcome -->
  <section>
    <h2>User Information</h2>
    <p>Here you will find your account details and session expiry status.</p>
  </section>

  <!-- Section 2: Notifications -->
  <section>
    <h2>Notifications</h2>
    <p>No new notifications at this time.</p>
  </section>

  <!-- Section 3: Account Information -->
  <section>
    <h2>Account Status</h2>
    <p id="account-status">Checking expiry date...</p>
  </section>

  <!-- Section 4: Logout Button -->
  <section>
    <button class="btn btn-danger btn-logout" onclick="LogOut()">Logout</button>
  </section>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <script>
    // Firebase Configuration Initialization
    const firebaseConfig = {/* Firebase configuration */};
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const database = firebase.database();

    // Display user email and monitor expiry
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("email-id").textContent = `Hello, ${user.email}`;
        checkExpiry(user);
      } else {
        window.location.href = 'index.html';
      }
    });

    // Check and handle expiry date
    function checkExpiry(user) {
      const userRef = database.ref(`users/${user.uid}`);
      userRef.once('value').then(snapshot => {
        const userData = snapshot.val();
        const expiryDate = new Date(userData?.expiryDate);
        const currentDate = new Date();

        if (currentDate > expiryDate) {
          document.getElementById("account-status").textContent = "Your session has expired.";
          alert('Your session has expired. Logging out.');
          LogOut();
        } else {
          document.getElementById("account-status").textContent = `Session Active until: ${expiryDate.toDateString()}`;
        }
      });
    }

    // Logout function
    function LogOut() {
      auth.signOut().then(() => {
        alert('Successfully logged out.');
        window.location.href = 'index.html';
      }).catch(error => {
        console.error('Error during logout:', error);
      });
    }
  </script>
</body>
</html>
